<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="utf-8">
    <script src="~/Content/scripts/jquery/jquery-2.0.3.min.js" type="text/javascript"></script>
    <link href="~/Content/scripts/bootstrap/bootstrap.min.css" rel="stylesheet" />
    <script src="/Content/scripts/bootstrap/bootstrap.min.js"></script>    
    <link href="~/Content/scripts/bootstrap/bootstrap-select.min.css" rel="stylesheet" />
    <script src="~/Content/scripts/bootstrap/bootstrap-select.min.js"></script>
    <script src="~/Content/scripts/plugins/datepicker/WdatePicker.js"></script>
    <link href="~/Content/css/mapcss.css" rel="stylesheet" />    
    <!--jqgrid表格组件start-->
    <link href="~/Content/scripts/plugins/jqgrid/jqgrid.css" rel="stylesheet" />
    <script src="~/Content/scripts/plugins/jqgrid/grid.locale-cn.js"></script>
    <script src="~/Content/scripts/plugins/jqgrid/jqgrid.min.js"></script>
    <!--表格组件end-->
    <link href="~/Content/styles/hzsoft-report.css" rel="stylesheet" />
    <link href="~/Content/layer2/mobile/need/layer.css" rel="stylesheet" />
    <script src="~/Content/layer2/layer.js" type="text/javascript"></script>
</head>
<body style="height: 100%; margin: 0">
    <div id="formAreas">
        <div class="titlePanel" style="border:none">
            <div class="title-search">
                <table>
                    <tr>
                        <td>查询条件</td>
                        <td style="padding-left: 10px;">
                            <div class="ui-filter" style="width: 200px;">
                                <div class="ui-filter-text">
                                    <strong id="SelectedStartTime">@DateTime.Now.AddMonths(-1).ToString("yyyy-MM-dd")</strong> 至 <strong id="SelectedEndTime">@DateTime.Now.ToString("yyyy-MM-dd")</strong>
                                </div>
                                <div class="ui-filter-list" style="width: 350px;">
                                    <table class="form" id="filter-form">
                                        <tr>
                                            <th class="formTitle">成立日期：</th>
                                            <td class="formValue">
                                                <div style="float: left; width: 45%;">
                                                    <input id="StartTime" readonly type="text" class="form-control input-wdatepicker" onfocus="WdatePicker({maxDate:'%y-%M-%d'})">
                                                </div>
                                                <div style="float: left; width: 10%; text-align: center;">至</div>
                                                <div style="float: left; width: 45%;">
                                                    <input id="EndTime" readonly type="text" class="form-control input-wdatepicker" onfocus="WdatePicker()">
                                                </div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">公司名称：</td>
                                            <td class="formValue">
                                                <input id="CompanyName" type="text" class="form-control">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">商圈：</td>
                                            <td class="formValue">
                                                <input id="RegeoName" type="text" class="form-control">
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">经营范围：</td>
                                            <td class="formValue">
                                                <input id="Scope" type="text" class="form-control">
                                            </td>
                                        </tr>

                                        <tr>
                                            <td class="formTitle">区县：</td>
                                            <td class="formValue">
                                                <select id="DistrictCondition" class="selectpicker bla bla bli" multiple style="width:50px">
                                                    <option>兰山区</option>
                                                    <option>罗庄区</option>
                                                    <option>河东区</option>
                                                    <option>沂南县</option>
                                                    <option>郯城县</option>
                                                    <option>沂水县</option>
                                                    <option>兰陵县</option>
                                                    <option>费县</option>
                                                    <option>平邑县</option>
                                                    <option>莒南县</option>
                                                    <option>蒙阴县</option>
                                                    <option>临沭县</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">行业：</td>
                                            <td class="formValue">
                                                <select id="SectorCondition" class="selectpicker bla bla bli" multiple style="width:50px">
                                                    <option>农、林、牧、渔业</option>
                                                    <option>采矿业</option>
                                                    <option>制造业</option>
                                                    <option>电力、热力、燃气及水生产和供应业</option>
                                                    <option>建筑业</option>
                                                    <option>批发和零售业</option>
                                                    <option>交通运输、仓储和邮政业</option>
                                                    <option>住宿和餐饮业</option>
                                                    <option>信息传输、软件和信息技术服务业</option>
                                                    <option>金融业</option>
                                                    <option>房地产业</option>
                                                    <option>租赁和商业服务业</option>
                                                    <option>科学研究和技术服务业</option>
                                                    <option>水利、环境和公共设施管理业</option>
                                                    <option>居民服务、修理和其他服务业</option>
                                                    <option>教育</option>
                                                    <option>卫生和社会工作</option>
                                                    <option>文化、体育和娱乐业</option>
                                                    <option>公共管理、社会保障和社会组织</option>
                                                    <option>国际组织</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">POI类别：</td>
                                            <td class="formValue">
                                                <select id="TypeNameCondition" class="selectpicker bla bla bli" multiple style="width:50px">
                                                    @*data-live-search="true"*@
                                                    <option>住宅小区</option>
                                                    <option>商务写字楼</option>
                                                    <option>住宅区</option>
                                                    <option>商住两用楼宇</option>
                                                    <option>产业园区</option>
                                                    <option>商务住宅相关</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">获取人：</td>
                                            <td class="formValue">
                                                <div id="ObtainUserId" type="selectTree" class="ui-select"></div>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td class="formTitle">状态</td>
                                            <td class="formValue">
                                                <div id="FollowState" type="select" class="ui-select">
                                                </div>
                                            </td>
                                        </tr>
                                    </table>
                                    <div class="ui-filter-list-bottom">
                                        <a id="btn_Reset" class="btn btn-default">&nbsp;重&nbsp;&nbsp;置</a>
                                        <a id="btn_Search" class="btn btn-primary">&nbsp;查&nbsp;&nbsp;询</a>
                                    </div>
                                </div>
                            </div>
                        </td>
                        <td style="padding-left: 10px;">
                            <div id="time_horizon" class="btn-group">
                                <a class="btn btn-default" data-value="1">今天</a>
                                <a class="btn btn-default" data-value="2">本周</a>
                                <a class="btn btn-default" data-value="3">本月</a>
                                <a class="btn btn-default" data-value="4">本年</a>
                                <a class="btn btn-default active" data-value="5">全部</a>
                            </div>
                        </td>
                        <td style="padding-left: 2px;">
                            &nbsp;&nbsp;&nbsp;&nbsp;   皮肤
                        </td>
                        <td style="padding-left: 10px;">
                            <div id="skin_horizon" class="btn-group">
                                <div id="skin_horizon" class="btn-group">
                                    <a class="btn btn-default" data-value="11">默认</a>
                                    <a class="btn btn-default" data-value="33">暗黑</a>
                                    <a class="btn btn-default" data-value="22">淡灰</a>
                                </div>
                            </div>
                        </td>
                    </tr>
                </table>
            </div>
            <div class="toolbar">
                <div class="btn-group">
                    <a id="lr-replace" class="btn btn-default" onclick="window.location.reload();"><i class="fa fa-refresh"></i>&nbsp;刷新</a>
                    <a id="lr-ping" class="btn btn-default" onclick="toggleFullScreen();"><i class="fa fa-refresh"></i>&nbsp;全屏</a>
                </div>
            </div>
        </div>
        <div id="container"></div>

    </div>
    <script src="~/Content/scripts/echarts/map/echarts.min.js"></script>
    <script src="~/Content/scripts/echarts/map/china.js"></script>
    @*<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/echarts-all-3.js"></script>*@
    @*<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/map/js/china.js"></script>*@
    <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=RlfFOspIQ8dKk4Cc6LNaMgXwhM32ZH5v"></script>@*ZUONbpqGBsYGXNIYHicvbAbM*@
    @*<script type="text/javascript" src="http://echarts.baidu.com/gallery/vendors/echarts/extension/bmap.min.js"></script>*@
    <script src="~/Content/scripts/echarts/map/bmap.js"></script>
    <script type="text/javascript" src="http://api.map.baidu.com/library/DistanceTool/1.2/src/DistanceTool_min.js"></script>
    <!--加载鼠标绘制工具-->
    <script type="text/javascript" src="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/DrawingManager/1.4/src/DrawingManager_min.css" />
    <!--加载检索信息窗口-->
    <script type="text/javascript" src="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.js"></script>
    <link rel="stylesheet" href="http://api.map.baidu.com/library/SearchInfoWindow/1.4/src/SearchInfoWindow_min.css" />
    <link href="/Content/styles/hzsoft-ui.css" rel="stylesheet">
    <script src="~/Content/scripts/utils/hzsoft-ui.js"></script>
    <link href="~/Content/scripts/plugins/tree/tree.css" rel="stylesheet" />
    <script src="~/Content/scripts/plugins/tree/tree.js"></script>
    <script src="~/Content/adminDefault/index.js"></script>
    <script src="~/Content/scripts/dms/map_public.js"></script>
    <link href="~/Content/layer2/mobile/need/layer.css" rel="stylesheet" />
    <script src="~/Content/layer2/layer.js" type="text/javascript"></script>
    <link href="~/Content/scripts/plugins/jquery-ui/jquery-ui.min.css" rel="stylesheet" />
    <script src="~/Content/scripts/plugins/jquery-ui/jquery-ui.min.js"></script>
    <script type="text/javascript">
        var LocationId = unescape(request('LocationId'));
        var LocationIds = unescape(request('LocationIds'));
        var StartTime = request('StartTime');
        var EndTime = request('EndTime');
        var CompanyName = unescape(request('CompanyName'));
        var RegeoName = unescape(request('RegeoName'));
        var Scope = unescape(request('Scope'));
        var Sector = unescape(request('Sector'));
        var District = unescape(request('District'));
        var TypeName = unescape(request('TypeName'));
        var ObtainUserId = unescape(request('ObtainUserId'));
        var FollowState = unescape(request('FollowState'));

        var resultData = new Array();
        var seriesData = new Array();
        var countAll = 0;
        var dom = document.getElementById("container");
        dom.style.height = window.screen.height + "px";
        var myChart = echarts.init(dom);

        $(function () {
            InitialPage();
            GetGrid();
            autocomplete();
        });

        function autocomplete() {
            var cache = {};
            $("#CompanyName").autocomplete({
                source: function (request, response) {
                    var term = request.term;
                    if (term in cache) {
                        response(cache[term]);
                        return;
                    }
                    $.ajax({
                        type: "POST",
                        url: "/CustomerManage/Ku_Company/CompanyNameAuto",
                        data: { CompanyName: request.term, rnd: Math.random() },
                        success: function (data) {
                            var ary = [];
                            if (data != "") {
                                var result = JSON.parse(data);
                                for (var i = 0; i < result.length; i++) {
                                    ary.push(result[i].CompanyName.replace(/(^\s*)|(\s*$)/g, ""));
                                }
                            }
                            response(ary);
                        },
                        error: function () {
                            layer.alert('错误', {
                                skin: 'layui-layer-molv', closeBtn: 0
                            });
                        }
                    });
                },
                minLength: 1,
                select: function (event, ui) {
                    var name = ui.item.value;
                    if (name != '') {
                        $("#CompanyName").val(name);
                    }
                },
                delay: 500,
                minLength: 2,
                html: true,
                open: function (event, ui) {
                    $(".ui-autocomplete").css("z-index", 1000);
                }
            });
        }

        //初始化页面
        function InitialPage() {
            //销售人员
            $("#ObtainUserId").ComboBoxTree({
                url: "../../BaseManage/User/GetTreeJson",
                description: "==请选择==",
                height: "360px",
                width: "280px"
            });
            //状态
            $("#FollowState").ComboBox({
                url: "../../SystemManage/DataItemDetail/GetDataItemListJson",
                param: { EnCode: "FollowState" },
                id: "ItemValue",
                text: "ItemName",
                description: "==请选择==",
                height: "200px"
            });

            if (!!StartTime && !!EndTime) {
                $("#StartTime").val(StartTime);
                $("#EndTime").val(EndTime);
            }
            if (!!CompanyName) {
                $("#CompanyName").val(CompanyName);
            }
            if (!!RegeoName) {
                $("#RegeoName").val(RegeoName);
            }
            if (!!Scope) {
                $("#Scope").val(Scope);
            }
            if (!!Sector) {
                $("#SectorCondition").selectpicker('val', Sector.split(','));
            }
            if (!!District) {
                $("#DistrictCondition").selectpicker('val', District.split(','));
            }
            if (!!TypeName) {
                $("#TypeNameCondition").selectpicker('val', TypeName.split(','));
            }
            if (!!ObtainUserId) {
                $("#ObtainUserId").val(ObtainUserId);
            }
            if (!!FollowState) {
                $("#FollowState").val(FollowState);
            }

            //点击皮肤
            $("#skin_horizon a.btn-default").click(function () {
                $("#skin_horizon a.btn-default").removeClass("active");
                $(this).addClass("active");
                var option = myChart.getOption();
                switch ($(this).attr('data-value')) {
                    case "11"://全部
                        option.bmap[0].mapStyle = mapStyle11;
                        myChart.setOption(option);
                        //window.location.reload();
                        break;
                    case "22"://全部
                        option.bmap[0].mapStyle = mapStyle22;
                        myChart.setOption(option);
                        break;
                    case "33"://全部
                        option.bmap[0].mapStyle = mapStyle33;
                        myChart.setOption(option);
                        break;
                    default:
                        break;
                }
            });
        }

        function GetGrid() {
            //点击时间范围
            $("#time_horizon a.btn-default").click(function () {
                $("#time_horizon a.btn-default").removeClass("active");
                $(this).addClass("active");
                switch ($(this).attr('data-value')) {
                    case "1"://今天
                        $("#StartTime").val("@DateTime.Now.ToString("yyyy-MM-dd")");
                        $("#EndTime").val("@DateTime.Now.ToString("yyyy-MM-dd")");
                        break;
                    case "2"://本周
                        $("#StartTime").val("@DateTime.Now.AddDays(1 - Convert.ToInt32(DateTime.Now.DayOfWeek.ToString("d"))).ToString("yyyy-MM-dd")");
                        $("#EndTime").val("@DateTime.Now.ToString("yyyy-MM-dd")");
                        break;
                    case "3"://本月
                        $("#StartTime").val("@DateTime.Now.ToString("yyyy-MM-01")");
                        $("#EndTime").val("@DateTime.Now.ToString("yyyy-MM-dd")");
                        break;
                    case "4"://本年
                        $("#StartTime").val("@DateTime.Now.ToString("yyyy-01-01")");
                        $("#EndTime").val("@DateTime.Now.ToString("yyyy-MM-dd")");
                        break;
                    case "5"://全部
                        $("#StartTime").val("");
                        $("#EndTime").val("");
                        break;
                    default:
                        break;
                }
                $("#SelectedStartTime").html($("#StartTime").val());
                $("#SelectedEndTime").html($("#EndTime").val());
                doserch();
            });

            //查询事件
            $("#btn_Search").click(function () {
                doserch();
            });

            doserch();
        }


        function doserch() {
            //加载层-默认风格
            layer.load();
            if (!$(".ui-filter-text").next('.ui-filter-list').is(":hidden")) {
                $(".ui-filter-text").trigger("click");
            }
            $("#SelectedStartTime").html($("#StartTime").val());
            $("#SelectedEndTime").html($("#EndTime").val());

            var queryJson = $("#filter-form").GetWebControls();
            if (!!LocationId) {
                queryJson.LocationId = LocationId;
            }
            if (!!LocationIds) {
                queryJson.LocationIds = LocationIds;
            }
            queryJson.District = $("#DistrictCondition").selectpicker('val');
            queryJson.Sector = $("#SectorCondition").selectpicker('val');
            queryJson.TypeName = $("#TypeNameCondition").selectpicker('val');

            Sector = queryJson.Sector;
            District = queryJson.District;
            TypeName = queryJson.TypeName;

            StartTime = queryJson.StartTime;
            EndTime = queryJson.EndTime;
            CompanyName = queryJson.CompanyName;
            RegeoName = queryJson.RegeoName;
            Scope = queryJson.Scope;
            ObtainUserId = queryJson.ObtainUserId;
            FollowState = queryJson.FollowState;

            $.ajax({
                type: "POST",
                url: "/ReportManage/Dms/GetLocationData",
                data: { queryJson: JSON.stringify(queryJson), rnd: Math.random() },
                success: function (data) {
                    if (data) {
                        seriesData = [];
                        seriesData[0] = new Array();
                        seriesData[1] = new Array();
                        seriesData[2] = new Array();
                        seriesData[3] = new Array();
                        countAll = 0;
                        resultData = JSON.parse(data);
                        for (var j = 0; j < resultData.length; j++) {
                            countAll += resultData[j].count;
                            var res = [resultData[j].bdlon, resultData[j].bdlat, resultData[j].id, resultData[j].code, resultData[j].name, resultData[j].count];
                            if (resultData[j].count == 1) {
                                seriesData[0].push(res);
                            }
                            else if (resultData[j].count >= 50 && resultData[j].count < 100) {
                                seriesData[2].push(res);
                            }
                            else if (resultData[j].count >= 100) {
                                seriesData[3].push(res);
                            }
                            else {
                                seriesData[1].push(res);
                            }
                        }

                        var option = myChart.getOption();
                        option.bmap[0].mapStyle = mapStyle11;

                        option.series[0]= {
                            name: 'Shop',
                            type: 'scatter',
                            coordinateSystem: 'bmap',
                            data: seriesData[0],
                            symbolSize: 8,
                            showEffectOn: 'render',
                            rippleEffect: {
                                brushType: 'stroke'
                            },
                            itemStyle: {
                                normal: {
                                    color: '#50a3ba'
                                }
                            },
                            zlevel: 1
                        }
                        option.series[1] = {
                            name: 'Office',
                            type: 'scatter',
                            coordinateSystem: 'bmap',
                            data: seriesData[1],// tArray.slice(0, 5)
                            symbol: 'pin',//标记钉子，默认圆形ECharts 提供的标记类型包括 'circle'(圆形), 'rect'（矩形）, 'roundRect'（圆角矩形）, 'triangle'（三角形）, 'diamond'（菱形）, 'pin'（大头针）, 'arrow'（箭头）
                            //也可以通过 'image://url' 设置为图片，其中 url 为图片的链接。'path:// 这种方式可以任意改变颜色并且抗锯齿
                            symbolSize: 25,
                            itemStyle: {
                                normal: {
                                    color: '#FFFF00',
                                }
                            },
                            label: {
                                normal: {
                                    formatter: function (params, ticket, callback) {
                                        return params.value[5];
                                    },
                                    position: 'top',
                                    show: true,
                                    color: '#00F',
                                    fontWeight: 'bolder',
                                    offset: [0, 20]
                                },
                            },
                        }
                        option.series[2] = {
                            name: 'Office50',
                            type: 'scatter',
                            coordinateSystem: 'bmap',
                            data: seriesData[2],// tArray.slice(0, 5)
                            symbol: 'diamond',//标记钉子，默认圆形ECharts 提供的标记类型包括 'circle'(圆形), 'rect'（矩形）, 'roundRect'（圆角矩形）, 'triangle'（三角形）, 'diamond'（菱形）, 'pin'（大头针）, 'arrow'（箭头）
                            //也可以通过 'image://url' 设置为图片，其中 url 为图片的链接。'path:// 这种方式可以任意改变颜色并且抗锯齿
                            symbolSize: 30,
                            itemStyle: {
                                normal: {
                                    color: '#FFFF00',
                                }
                            },
                            label: {
                                normal: {
                                    formatter: function (params, ticket, callback) {
                                        return params.value[5];
                                    },
                                    position: 'top',
                                    show: true,
                                    color: '#FFC',
                                    fontWeight: 'bolder',
                                    offset: [0, 20]
                                },
                            },
                        }
                        option.series[3] = {
                            name: 'Office100',
                            type: 'scatter',
                            coordinateSystem: 'bmap',
                            data: seriesData[3],// tArray.slice(0, 5)
                            symbol: 'roundRect',//标记钉子，默认圆形ECharts 提供的标记类型包括 'circle'(圆形), 'rect'（矩形）, 'roundRect'（圆角矩形）, 'triangle'（三角形）, 'diamond'（菱形）, 'pin'（大头针）, 'arrow'（箭头）
                            //也可以通过 'image://url' 设置为图片，其中 url 为图片的链接。'path:// 这种方式可以任意改变颜色并且抗锯齿
                            symbolSize: 30,
                            itemStyle: {
                                normal: {
                                    color: '#FFFF00',
                                }
                            },
                            label: {
                                normal: {
                                    formatter: function (params, ticket, callback) {
                                        return params.value[5];
                                    },
                                    position: 'top',
                                    show: true,
                                    color: '#FFC',
                                    fontWeight: 'bolder',
                                    offset: [0, 20]
                                },
                            },
                        }
                        option.title[0].subtext = '总数量：' + countAll + '个';
                        myChart.setOption(option);
                    }
                    setTimeout(function () { layer.closeAll('loading'); }, 1000);//延时1秒关闭加载图
                },
                error: function () {
                    layer.alert('错误', {
                        skin: 'layui-layer-molv', closeBtn: 0
                    });
                }
            });
        }

        var option = {
            bmap: {
                center: [118.338635, 35.064204],//118.345236, 35.067823
                zoom: 14,
                roam: true,
                enableMapClick: false,
            },
            title: {
                text: "全城企业分布",
                subtext: "",
                left: 'center',
                top: 5,
                backgroundColor: "rgba(255,255,255,0.8)",
                textStyle: {
                    color: "#2B98DC",
                    fontWeight: "bold"
                }
            },
            visualMap: {
                type: 'piecewise',
                show: true,
                top: '30',
                right: "5",
                orient: 'vertical',
                backgroundColor: "rgba(255,255,255,0.8)",
                min: 1,
                max: 5000,
                seriesIndex: 'all',
                calculable: true,
                pieces: [{
                    max: 2,
                }, {
                    max: 5,
                }, {
                    max: 10,
                }, {
                    max: 20,
                }, {
                    max: 50,
                }, {
                    max: 100,
                }, {
                    min: 100,
                }],
                inRange: {
                    color: ['#00FFFF', '#FFFF00', '#33FF33', '#1e90ff', "#ff4500", '#FF00FF', '#4b0082']
                }
            },
            brush: {
                outOfBrush: {
                    colorAlpha: 0.1
                },
                brushStyle: {
                    borderWidth: 2,
                    color: 'rgba(0,0,0,0.2)',
                    borderColor: 'rgba(0,0,0,0.5)',
                },
                seriesIndex: 'all',
                throttleType: 'debounce',
                throttleDelay: 300,
                geoIndex: 0
            },
            tooltip: {
                trigger: 'item',
                formatter: function (params, ticket, callback) {
                    var name = params.value[4];
                    return name;
                }
            },
        }

        myChart.setOption(option);

        myChart.on('click', function (params) {
            //关闭公司库搜索
            top.$.removeTab('b499a057-4fff-47b1-8768-76524d888220a');
            //打开公司库搜索
            top.tablist.newTab({
                id: 'b499a057-4fff-47b1-8768-76524d888220a', title: params.value[4].replace('(', '').replace(')', ''), closed: true, icon: "fa fa-bank",
                url: "/CustomerManage/Ku_Company/Ku_CompanyIndex?LocationId=" + params.value[2] +
                    "&StartTime=" + StartTime + "&EndTime=" + EndTime +
                    "&CompanyName=" + escape(CompanyName) + "&RegeoName=" + escape(RegeoName) + "&Scope=" + escape(Scope) +
                    "&District=" + escape(District) + "&Sector=" + escape(Sector) + "&TypeName=" + escape(TypeName),
            });

        });



        myChart.on('brushselected', renderBrushed);

        //去除默认的鼠标事件
        var tree = document.getElementById("container");
        tree.oncontextmenu = function () { return false; };

        //新加上鼠标右击事件
        myChart.on('contextmenu', showMenu);
        var LocationId;
        var RegeoId;
        var RegeoName;
        function showMenu(param) {
            var menu = document.getElementById("myMenu");
            menu.style.left = event.clientX + "px";
            menu.style.top = event.clientY + "px";
            menu.style.visibility = "visible";
            LocationId = param.data[2];
            RegeoId = param.data[3];
            RegeoName = param.data[4];

        }

        tree.onclick = function () {
            document.getElementById("myMenu").style.visibility = "hidden";
        }

        function editLocation() {
            dialogOpen({
                id: 'Form',
                title: '编辑坐标信息',
                url: '/CustomerManage/Ku_Location/Ku_LocationForm?keyValue=' + LocationId,
                width: '600px',
                height: '550px',
                callBack: function (iframeId) {
                    top.frames[iframeId].AcceptClick();
                }
            });
            document.getElementById("myMenu").style.visibility = "hidden";
        }

        function addCompany() {
            dialogOpen({
                id: 'Form',
                title: '添加公司',
                url: '/CustomerManage/Ku_Company/Ku_CompanyForm?LocationId=' + LocationId + '&RegeoId=' + RegeoId + '&RegeoName=' + escape(RegeoName),
                width: '700px',
                height: '610px',
                callBack: function (iframeId) {
                    top.frames[iframeId].AcceptClick();
                }
            });
            document.getElementById("myMenu").style.visibility = "hidden";
        }
        setTimeout(init, 0)
    </script>
    <div style="margin-left: 10px; margin-right: 20px;">
        <div class="ui-report">
            <table id="gridTable"></table>
            <div id="gridPager"></div>
        </div>
    </div>

    <div id="myMenu" style="position:absolute;visibility:hidden;background-color:silver" class="btn-group-vertical">
        <button type="button" class="btn btn-primary" onclick="editLocation()">编辑坐标</button>
        <button type="button" class="btn btn-primary" onclick="addCompany()">新建公司</button>
    </div>
</body>
</html>